         
   <html>
		<head>
			<title>FIGURE :: CONDUCT</title>
			
		        <script src="//code.jquery.com/jquery-1.11.2.min.js"> </script>
				<script type="text/javascript" src="/socket.io/socket.io.js"> </script>
				<script src="/socket.io/socket.io.js"></script>  
				<link rel="stylesheet" type="text/css" href="/css/style.css">
				<script type="text/javascript" src="/js/sketches.js"></script> 
				<script type="text/javascript" src="/js/classes.js"></script> 
		        <script src= "https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.22/p5.js"> </script>
	        	<script src= "https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.23/addons/p5.sound.js"> </script>
	        	<script src = "https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.23/addons/p5.dom.js"> </script>
			
				<script>  var socket = io(); </script> 	
				
				<script type="text/javascript">
							socket.on('connect', function() {
							socket.emit('gimme');
							console.log("Conducter in the house.");
						});


				</script>	
			

					<style>

							#everythingConductor {
								/*visibility: visible;*/
								display: block;
							}

							#everythingPerformer {
								/*visibility: hidden;*/
								display: none;
							}

					</style>
		</head>

<body> 
 			

 <div id="everythingConductor">

			<div class="sidebar" align="center"> 

				<< {{user}} >>  
				
				<!-- simple nav -->
				<nav>
					<div class="navButton" id="compose">  COMPOSE </div>
				    <div class="navButton" id="perform">  PERFORM </div>
				    <div class="navButton" id="conduct">  CONDUCT </div>
				</nav>

				<p>
				<p>

				<!-- PERFORMER channel update -->	
				<input type="number" id="myNumber" value="0">
				<p>
				<button onclick="updatePerfCount()">Update Channel Count </button>
				<p>

				<!-- You are Sending To:
				<div id="sendingTo">  </div> -->

			</div>


	<div id="main" align="center">

			<!-- holds performer buttons -->
			<div id="performer-container">
				<p>
				<div id="switcher"> SWITCH </div> <p>
				<p>
			 </div>		

			<p> Images <p>

         	{{#images}}                              		
         	<div class="figuresB">                 
              <img src={{.}} class="imageF " width="100px" height="100px">  </img>
              <span class="imageText">  </span>   
            </div>
            {{/images}}
          
     
          	<p> Videos <p>
          	{{#videos}}
          	<video src={{.}} class="videoF" width="100px" height="100px"> </video>
          	{{/videos}}

          	<p> Waveforms <p>
          	{{#audio}}
          	<div class="audio" title={{.}}>  </div>
          	{{/audio}}

          	{{#audionames}}
          	<div class="audionames" title={{.}} style.visibility="hidden">  </div>
          	{{/audionames}}



    </div>

	
	
	<script type="text/javascript">




//////////////////////////////////////////////// BEGIN CONDUCTOR SCRIPT //


				// working  (from line 322)
				var toWhom = 0;  // initialize these globally, used in server and emit to performers
				var toAll = 0;
				var divs = [];

				var member = 0;
				var group = [];
				var whoWhat = [];
					
				//from line 154
				var perfs = [];   
				var pX;

				//navigation   (from line 328)
				$(compose).click(function(){
		        	$(location).attr('href', '/compose') ;   
			    });

			    $(perform).click(function(){
			        $(location).attr('href', '/performer') ;   
			    });

			    $(conduct).click(function(){
			        $(location).attr('href', '/conductor') ;   
			    });

				    //SWITCHER (from line 336)
					$(switcher).click(function(){

						console.log('switch ' + toWhom);
						socket.emit('switch', toWhom);

						document.getElementById("everythingPerformer").style.display = "block";
						document.getElementById("everythingConductor").style.display= "none";

						//this activates whichever p5 sketch
						performerSketch();

					});



		// DYNAMIC PERF SHIZZ	

		//  taking the number of performer channels input by conductor
		//  sending the perfcount to all of the performers as a global var pX
		//  adding event listeners for clikc functionality

		// var perfs = [];
		// var pX;
		
		function updatePerfCount() {

		pX = document.getElementById("myNumber").value;

		socket.emit('perfCount', pX);

	  			$('.performerDivB').remove();
	  			perfs = [];

		    		for(i=0; i < pX ; i++){
					    	perfs[i] = document.createElement('div');
					    	perfs[i].className = 'performerDivB';
					    	perfs[i].id = 'cp' + (i+1);
					    	perfs[i].innerHTML = i + 1;
					    	document.getElementById('performer-container').appendChild(perfs[i]);
					    	whoWhat[i] = ' ';
					    };



						for (var i = 0; i < pX; i++){
		    				$('#cp' + (i+1)).click(doTheThing(i));
		    			};	
					};

				function doTheThing(index) {

			    	return function(){ 

			    		var num = index + 1;
			    		var perfID = "#cp" + (num);
			    			
					 	//document.getElementById('sendingTo').innerHTML = num;			 			

			 			$(perfID).fadeTo("fast", 0.5); 
				    	$(perfID).css('color', 'red');
				    	
				    	toAll = 0;
			 			toWhom = num;

			 			group[member] = toWhom;

			 			member = member + 1;

			 			//need to zero out 'member' when figure is sent
			 			console.log(group);
			 			
			 			//may not need this when grouping is done	
			 			socket.emit('toGroup', group);
			 			socket.emit('sendingTo', toWhom, toAll);
			 			socket.emit('sendingAll', toAll);

			 			};
		 			};

////////////////////////// END DYNAMIC PERF SHIZZ	


///////////////////////// FIGURE IMAGES > BUTTONS


		// this block is taking the number of images and adding ID's for button functions

		var imageIds = document.getElementsByClassName("imageF");  // from image tag above
		var imageSrcs = [];  //sending this to the socket emit
		var imageTxtIds = document.getElementsByClassName("imageText");  // from text tag


		//assign ids to all of the images
		for (i = 0; i < imageIds.length; i++) {
			imageIds[i].id = 'iF'+ i;	
		};

		//assign ids to the text overlay divs
		for (i = 0; i < imageTxtIds.length; i++) {
			imageTxtIds[i].id = 'iT'+ i;	
			//console.log(imageTxtIds[i].id);
		};
	
		// get the urls of images
		for (i = 0; i < imageIds.length; i++) {
			imageSrcs[i] = imageIds[i].src;
		};

		//seth helped with this  -- add button functionalities
		for(var i = 0; i < imageIds.length; i ++){
			$("#iF" + i).click(fadeTheFadeI(i));
		};

		
		//add the urls to the button

		function fadeTheFadeI(index){
			
			console.log('hello?');
			//debugger

			return function(){
				var image = "#iF" + index; 
				$(image).fadeTo("slow", 0.5);				
				socket.emit('imageFigure', imageSrcs[index]);

				// for(i = 0; i< group.length; i++){
				// 	console.log(group[i]);
				// }

				// display who is playing figure
				document.getElementById('iT' + index).innerHTML = group;

				for (i=0; i<perfs.length; i++){

					whoWhat[group[i]] =	'iT' + index;	
				};

				// for (var i = 0; i < whoWhat.length; i++){
				// 	if (whoWhat[i]) === 'iT' + index;
				// }



					console.log(whoWhat);	

				for (i=0; i < whoWhat.length; i++){
					
					//console.log(whoWhat[i]);
				
				};
				
				
				// this clears the group when an image is sent
				group = [];
				member = 0;

				// this clears the button states when an image is sent
				for (i=0; i < perfs.length; i++){
					$('#cp' + (i+1)).css('color', 'white');
				};

				for (i=0; i < perfs.length; i++){
					$('#cp' + (i+1)).fadeTo("fast", 1.0);
				};

		

			};
		};	


		//video buttons

		var videoIds = document.getElementsByClassName("videoF");  // from image tag above
		var videoIdsLength = videoIds.length;
		var videoSrcs = [];  //sending this to the socket emit

		//create unique id's for videos
		for (i = 0; i < videoIds.length; i++) {
			videoIds[i].id = 'vF'+ i;	
		};
		// gut the urls of videos
		for (i = 0; i < videoIds.length; i++) {
			videoSrcs[i] = videoIds[i].src;
		};
		//seth helped with this  -- add button functionalities
		for(var i = 0; i < videoIds.length; i ++){
			$("#vF" + i).click(fadeTheFadeV(i));
		};
		//add the urls to the button
		function fadeTheFadeV(index){
			return function(){
				$("#vF" + index).fadeTo("slow", 0.5);
				socket.emit('videoFigure', videoSrcs[index])
			};
		};	


		// audio buttons

		var waveIds = document.getElementsByClassName("audio");  // from image tag above
		var waveIdsLength = waveIds.length;
		var waveSrcs = [];  //sending this to the socket emit
		var waveNames = document.getElementsByClassName("audionames");
		
		//console.log(audioNames)
		//create unique id's for videos
		for (i = 0; i < waveIds.length; i++) {
			waveIds[i].id = 'aF'+ i;	
		};
		// gut the urls of videos
		for (i = 0; i < waveIds.length; i++) {

			waveIds[i].innerHTML = waveNames[i].title;

			waveSrcs[i] = waveIds[i].title;
			//console.log(waveSrcs);
		};
		//seth helped with this  -- add button functionalities
		for(var i = 0; i < waveIds.length; i ++){
			$("#aF" + i).click(fadeTheFadeA(i));
		};
		//add the urls to the button
		function fadeTheFadeA(index){
			return function(){
				$("#aF" + index).fadeTo("slow", 0.5);
				socket.emit('waveSketch', waveSrcs[index])
			};
		};	

				// // working
				// var toWhom = 0;  // initialize these globally, used in server and emit to performers
				// var toAll = 0;
				// var divs = [];


				// //SWITCHER
				// $(switcher).click(function(){

				// 	console.log('switch ' + toWhom);
				// 	socket.emit('switch', toWhom);

				// 	document.getElementById("everythingPerformer").style.display = "block";
				// 	document.getElementById("everythingConductor").style.display= "none";

				// 	//this activates whichever p5 sketch
				// 	performerSketch();

				// });


				// //navigation   from line 328

				// $(compose).click(function(){
		  //       	$(location).attr('href', '/compose') ;   
			 //    });

			 //    $(perform).click(function(){
			 //        $(location).attr('href', '/performer') ;   
			 //    });

			 //    $(conduct).click(function(){
			 //        $(location).attr('href', '/conductor') ;   
			 //    });
					 






			////////////////// END CONDUCTOR SCRIPT
		

			</script>

		</div>

		<div id="everythingPerformer">

			Hello {{user}}...  <br>

		<div id="perfDialogue" align="left"> 

				<!-- redo these with % -->

				Join as Performer:	 			
			<a>  
				<div class="performerDiv" id="perf1"> 1 </div> 
				<div class="performerDiv" id="perf2"> 2 </div> 
				<div class="performerDiv" id="perf3"> 3 </div> 
				<div class="performerDiv" id="perf4"> 4 </div> 
				<div class="performerDiv" id="perf5"> 5 </div> 


				
				<p>
				<div id="bpm"> </div>
				

			</a>

			<br>
			<br>
			<br>
					 <!-- responds to the "incoming" function -->
			<img src="/assets/incoming.png"  id="incoming"  style="width:167px; height:50">

	</div> 

	 <br>
	 
			<div id="figures" align="center">
	 		
	 <!-- This is where each new figure is injected into the performer page.
	 	  "currentFigure" is the name of the element that needs to be updated from conductor page. -->


	 	  		<!-- <div id="timeLine"> </div> -->

	 	  		<div id="sketchFigure"> </div>

			 	<video id="videoFig" width="800" height="0" autoplay loop src=" " type="video/mp4"> </video>
			 	
			 	<img id="imageFig" width="800" height="600" src="/assets/tacet.png" > </img>
			 	

			</div>

 
 <script type="text/javascript">



/////// BEGIN PERFORMER SCRIPT

 				
 				//actually calls th p5  (p5 sketches in /public/js)

					

					// DEFAULT p5 elements should be called globally?
					// maybe better to call them to preserve cpu 

					//var myp5 = new p5(tempo, 'bpm'); 

					// var myp5 = new p5(waveForm, 'timeLine');
					  

					

					//initialize globals
					var myId = 0; 
					var toWhom = 0;
					var toAll = 0;


		$(incoming).fadeTo(1,0);

		//performer buttons

	 	$(perf1).click(function(){

	 		myId = 1;

	 		$(perf1).fadeTo(500, 0.5);
	 		$(perf2).fadeTo(500, 1);			 		
	 		$(perf3).fadeTo(500, 1);
	 		$(perf4).fadeTo(500, 1);
	 		$(perf5).fadeTo(500, 1);

	 		$(perf1).css('color', 'red');
	 		$(perf2).css('color', 'white');
	 		$(perf3).css('color', 'white');
	 		$(perf4).css('color', 'white');
	 		$(perf5).css('color', 'white');
	 		
			console.log("I am Performer " + myId);
	 	}
	 );

	 	$(perf2).click(function(){

	 		myId = 2;

	 		$(perf1).fadeTo(500, 1);
	 		$(perf2).fadeTo(500, 0.5);			 		
	 		$(perf3).fadeTo(500, 1);
	 		$(perf4).fadeTo(500, 1);
	 		$(perf5).fadeTo(500, 1);

	 		$(perf1).css('color', 'white');
	 		$(perf2).css('color', 'red');
	 		$(perf3).css('color', 'white');
	 		$(perf4).css('color', 'white');
	 		$(perf5).css('color', 'white');

			console.log("I am Performer " + myId);		
	 	}
	 );

	 	$(perf3).click(function(){

	 		myId = 3;

	 		$(perf1).fadeTo(500, 1);
	 		$(perf2).fadeTo(500, 1);			 		
	 		$(perf3).fadeTo(500, 0.5);
	 		$(perf4).fadeTo(500, 1);
	 		$(perf5).fadeTo(500, 1);

	 		$(perf1).css('color', 'white');
	 		$(perf2).css('color', 'white');
	 		$(perf3).css('color', 'red');
	 		$(perf4).css('color', 'white');
	 		$(perf5).css('color', 'white');

	 		console.log("I am Performer " + myId);
	 	}
	 );

		$(perf4).click(function(){

	 		myId = 4;

	 		$(perf1).fadeTo(500, 1);
	 		$(perf2).fadeTo(500, 1);			 		
	 		$(perf3).fadeTo(500, 1);
	 		$(perf4).fadeTo(500, 0.5);
	 		$(perf5).fadeTo(500, 1);

	 		$(perf1).css('color', 'white');
	 		$(perf2).css('color', 'white');
	 		$(perf3).css('color', 'white');
	 		$(perf4).css('color', 'red');
	 		$(perf5).css('color', 'white');

	 		console.log("I am Performer " + myId);
	 	}
	 );	 	


		$(perf5).click(function(){

	 		myId = 5;

	 		$(perf1).fadeTo(500, 1);
	 		$(perf2).fadeTo(500, 1);			 		
	 		$(perf3).fadeTo(500, 1);
	 		$(perf4).fadeTo(500, 1);
	 		$(perf5).fadeTo(500, 0.5);

	 		$(perf1).css('color', 'white');
	 		$(perf2).css('color', 'white');
	 		$(perf3).css('color', 'white');
	 		$(perf4).css('color', 'white');
	 		$(perf5).css('color', 'red');

	 		console.log("I am Performer " + myId);
	 	}
	 );

	 				// functions (just one right now)
	 				var flashIncoming = function(){

						$(incoming).fadeTo(500, 1);
						$(incoming).fadeTo(500, 0);

						};

						// routes messages across channels

						socket.on('sendingTo', function (data) {							
							toWhom = data;
							console.log("toWhom = " + toWhom);
							
						});

						socket.on('sendingAll', function (data) {							
							toAll = data;
							console.log("toAll= " + toAll);	
							
						});

						//sets up flashing of incoming image referenced above
				


						socket.on('videoFigure', function (data) {


								//checks to see if conductor is talking to "you"
							if (myId == toWhom || toAll == 1) { 

								//flashes "incoming" image 
							var flasher = setInterval(function() {flashIncoming()} , 500);

								// shuts off incoming flasher after interval
							setTimeout(function() {clearInterval(flasher)}, 2000);
							setTimeout(function() {display()}, 3000);

							// display shitz
							var display = function(){
							console.log(data + "performerside" + toWhom);

							document.getElementById('imageFig').src = "";
							document.getElementById('imageFig').height = "0";

							document.getElementById('videoFig').src = data;
							document.getElementById('videoFig').height = "600";
								}
							}							
						});

					

						socket.on('imageFigure', function (data) {

							if (myId == toWhom || toAll == 1) {

								//flashes "incoming" image 
							var flasher = setInterval(function() {flashIncoming()} , 500);

								// shuts off incoming flasher after interval
							setTimeout(function() {clearInterval(flasher)}, 1500);
							setTimeout(function() {display()}, 3000);

								// display shitz
							var display = function(){
							console.log(data + "performerside" + toWhom);

							// NEED TO GET RID OF THIS HACKY WAY AND MAKE ONLY ONE DISPLAY AT A TIME
						    document.getElementById('videoFig').src = "";
						    document.getElementById('videoFig').height = "0";

							document.getElementById('imageFig').src = data;
							document.getElementById('imageFig').height = "600";

								}	
							}
						});



				
// // // // // // // // // //  END PERFORMER SCRIPT	

		</script>
	</div>   
 
 	</body>

</html>